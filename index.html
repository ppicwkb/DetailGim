<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DETAIL GIM - PPIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .mobile-scroll {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        .mobile-scroll::-webkit-scrollbar {
            height: 6px;
            width: 6px;
        }
        .mobile-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        .mobile-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .mobile-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        @media (max-width: 768px) {
            .mobile-table {
                font-size: 0.75rem;
            }
            .mobile-header {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="glass-effect shadow-xl border-b border-gray-200 sticky top-0 z-50">
        <div class="px-4 sm:px-6 py-3 sm:py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-2 rounded-xl shadow-lg">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg sm:text-2xl font-bold text-gray-800">Monitoring Stok</h1>
                        <p class="text-xs sm:text-sm text-gray-600 hidden sm:block">Sistem Monitoring Real-time</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <button onclick="refreshAllData()" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg flex items-center space-x-1 sm:space-x-2 transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        <span class="text-sm sm:text-base">Refresh</span>
                    </button>
                </div>
            </div>
            <div id="lastUpdate" class="text-xs text-gray-500 mt-2 sm:hidden"></div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="px-4 sm:px-6 py-3 sm:py-4">
        <div class="glass-effect rounded-xl shadow-lg p-1 card-shadow">
            <nav class="flex space-x-1">
                <button onclick="showTab('inbound')" id="tab-inbound" class="tab-button flex-1 py-2 sm:py-3 px-2 sm:px-4 text-center rounded-lg font-medium transition-all text-xs sm:text-sm">
                    <span class="block sm:inline">📥</span>
                    <span class="block sm:inline sm:ml-1">INBOUND</span>
                </button>
                <button onclick="showTab('outbound')" id="tab-outbound" class="tab-button flex-1 py-2 sm:py-3 px-2 sm:px-4 text-center rounded-lg font-medium transition-all text-xs sm:text-sm">
                    <span class="block sm:inline">📤</span>
                    <span class="block sm:inline sm:ml-1">OUTBOUND</span>
                </button>
                <button onclick="showTab('stock')" id="tab-stock" class="tab-button flex-1 py-2 sm:py-3 px-2 sm:px-4 text-center rounded-lg font-medium transition-all text-xs sm:text-sm">
                    <span class="block sm:inline">📊</span>
                    <span class="block sm:inline sm:ml-1">STOCK</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- Content Area -->
    <div class="px-4 sm:px-6 pb-6 sm:pb-8">
        <!-- Loading Indicator -->
        <div id="loading" class="hidden text-center py-8">
            <div class="loading w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-600 text-sm sm:text-base">Memuat data...</p>
        </div>

        <!-- Error Message -->
        <div id="error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-4 card-shadow">
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                <span id="errorMessage" class="text-sm sm:text-base"></span>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="hidden sm:block mb-4">
            <div class="glass-effect rounded-xl p-4 card-shadow">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm text-gray-600">Status: Online</span>
                    </div>
                    <div id="lastUpdate" class="text-sm text-gray-500"></div>
                </div>
            </div>
        </div>

        <!-- INBOUND Tab -->
        <div id="inbound-content" class="tab-content">
            <div class="glass-effect rounded-xl shadow-xl card-shadow p-4 sm:p-6">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4">
                    <h2 class="text-lg sm:text-xl font-bold text-gray-800 flex items-center">
                        <span class="mr-2">📥</span> Data Inbound
                        <span id="inbound-count" class="ml-2 bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full"></span>
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="exportData('inbound', 'pdf')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            📄 PDF
                        </button>
                        <button onclick="exportData('inbound', 'xlsx')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            📊 Excel
                        </button>
                        <button onclick="toggleView('inbound')" id="view-toggle-inbound" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            📊 Tabel
                        </button>
                    </div>
                </div>
                
                <!-- Search and Filter Controls -->
                <div class="mb-6 space-y-4">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <!-- Search Box -->
                        <div class="flex-1 relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input type="text" id="search-inbound" placeholder="Cari produk, brand, PO, atau data lainnya..." 
                                   class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                   oninput="performSearch('inbound')">
                            <button onclick="clearSearch('inbound')" id="clear-search-inbound" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 hidden">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Filter Controls -->
                        <div class="flex flex-wrap gap-2">
                            <select id="filter-brand-inbound" onchange="applyFilters('inbound')" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Semua Brand</option>
                            </select>
                            <select id="filter-size-inbound" onchange="applyFilters('inbound')" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Semua Size</option>
                            </select>
                            <input type="date" id="filter-date-inbound" onchange="applyFilters('inbound')" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" title="Filter berdasarkan tanggal">
                            <button onclick="resetFilters('inbound')" class="px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm transition-colors">
                                🔄 Reset
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Card View -->
                <div id="inbound-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Cards will be populated here -->
                </div>
                
                <!-- Table View -->
                <div id="inbound-table-view" class="hidden overflow-x-auto mobile-scroll">
                    <table class="w-full mobile-table">
                        <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                            <tr>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Armada</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Tanggal</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Produk</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Size</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Packing</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Brand</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">PO</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">QTY</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Delivery</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Jam</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Nett Weight</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Total Weight</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="inbound-table" class="bg-white divide-y divide-gray-100">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- OUTBOUND Tab -->
        <div id="outbound-content" class="tab-content hidden">
            <div class="glass-effect rounded-xl shadow-xl card-shadow p-4 sm:p-6">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4">
                    <h2 class="text-lg sm:text-xl font-bold text-gray-800 flex items-center">
                        <span class="mr-2">📤</span> Data Outbound
                        <span id="outbound-count" class="ml-2 bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full"></span>
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="exportData('outbound', 'pdf')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            📄 PDF
                        </button>
                        <button onclick="exportData('outbound', 'xlsx')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            📊 Excel
                        </button>
                        <button onclick="toggleView('outbound')" id="view-toggle-outbound" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            📊 Tabel
                        </button>
                    </div>
                </div>
                
                <!-- Search and Filter Controls -->
                <div class="mb-6 space-y-4">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <!-- Search Box -->
                        <div class="flex-1 relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input type="text" id="search-outbound" placeholder="Cari produk, invoice, brand, PO, atau data lainnya..." 
                                   class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                   oninput="performSearch('outbound')">
                            <button onclick="clearSearch('outbound')" id="clear-search-outbound" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 hidden">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Filter Controls -->
                        <div class="flex flex-wrap gap-2">
                            <select id="filter-brand-outbound" onchange="applyFilters('outbound')" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Semua Brand</option>
                            </select>
                            <select id="filter-size-outbound" onchange="applyFilters('outbound')" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Semua Size</option>
                            </select>
                            <input type="date" id="filter-date-outbound" onchange="applyFilters('outbound')" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" title="Filter berdasarkan tanggal">
                            <button onclick="resetFilters('outbound')" class="px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm transition-colors">
                                🔄 Reset
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Card View -->
                <div id="outbound-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Cards will be populated here -->
                </div>
                
                <!-- Table View -->
                <div id="outbound-table-view" class="hidden overflow-x-auto mobile-scroll">
                    <table class="w-full mobile-table">
                        <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                            <tr>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Tanggal</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Invoice</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Produk</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Size</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Packing</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Brand</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">PO</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">QTY</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Nett Weight</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Total Nett Weight</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="outbound-table" class="bg-white divide-y divide-gray-100">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- STOCK Tab -->
        <div id="stock-content" class="tab-content hidden">
            <div class="glass-effect rounded-xl shadow-xl card-shadow p-4 sm:p-6">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4">
                    <h2 class="text-lg sm:text-xl font-bold text-gray-800 flex items-center">
                        <span class="mr-2">📊</span> Data Stock
                        <span id="stock-count" class="ml-2 bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full"></span>
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="exportData('stock', 'pdf')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            📄 PDF
                        </button>
                        <button onclick="exportData('stock', 'xlsx')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            📊 Excel
                        </button>
                        <button onclick="toggleView('stock')" id="view-toggle-stock" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            📊 Tabel
                        </button>
                    </div>
                </div>
                
                <!-- Search and Filter Controls -->
                <div class="mb-6 space-y-4">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <!-- Search Box -->
                        <div class="flex-1 relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input type="text" id="search-stock" placeholder="Cari produk, brand, PO, atau data lainnya..." 
                                   class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                   oninput="performSearch('stock')">
                            <button onclick="clearSearch('stock')" id="clear-search-stock" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 hidden">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Filter Controls -->
                        <div class="flex flex-wrap gap-2">
                            <select id="filter-brand-stock" onchange="applyFilters('stock')" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Semua Brand</option>
                            </select>
                            <select id="filter-size-stock" onchange="applyFilters('stock')" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Semua Size</option>
                            </select>

                            <button onclick="resetFilters('stock')" class="px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-sm transition-colors">
                                🔄 Reset
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Card View -->
                <div id="stock-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Cards will be populated here -->
                </div>
                
                <!-- Table View -->
                <div id="stock-table-view" class="hidden overflow-x-auto mobile-scroll">
                    <table class="w-full mobile-table">
                        <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                            <tr>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Produk</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Size</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Packing</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Brand</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">PO</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">In GIM</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Out GIM</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Stok GIM</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Nett Weight</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Total Nett Weight</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider mobile-header whitespace-nowrap">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="stock-table" class="bg-white divide-y divide-gray-100">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="glass-effect rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-white">Detail Data</h3>
                    <button onclick="closeDetailModal()" class="text-white hover:text-gray-200 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="modalContent" class="p-6">
                <!-- Modal content will be populated here -->
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyBhiKDVDH4fle5_EqAIaA05YjpxVMEBYZM';
        const SHEET_ID = '1cfw4YUmI5A_0gCHQeA3Fr4PfeH-s6tvzbOsBorNnKr8';
        
        let currentTab = 'inbound';
        let cachedData = {
            inbound: null,
            outbound: null,
            stock: null
        };
        let filteredData = {
            inbound: null,
            outbound: null,
            stock: null
        };
        let viewModes = {
            inbound: 'card',
            outbound: 'card',
            stock: 'card'
        };
        let searchTerms = {
            inbound: '',
            outbound: '',
            stock: ''
        };
        let activeFilters = {
            inbound: { brand: '', size: '', date: '' },
            outbound: { brand: '', size: '', date: '' },
            stock: { brand: '', size: '' }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            showTab('inbound');
            loadAllData();
        });

        // Tab switching functionality
        function showTab(tabName) {
            currentTab = tabName;
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'text-white', 'shadow-lg', 'transform', 'scale-105');
                button.classList.add('text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            document.getElementById(`${tabName}-content`).classList.add('fade-in');
            
            // Add active class to selected tab
            const activeTab = document.getElementById(`tab-${tabName}`);
            activeTab.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'text-white', 'shadow-lg', 'transform', 'scale-105');
            activeTab.classList.remove('text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100');
            
            // Load data if not cached
            if (!cachedData[tabName]) {
                loadSheetData(tabName);
            }
        }

        // Load all data
        async function loadAllData() {
            showLoading(true);
            hideError();
            
            try {
                await Promise.all([
                    loadSheetData('inbound'),
                    loadSheetData('outbound'),
                    loadSheetData('stock')
                ]);
                await getSheetLastModified();
            } catch (error) {
                showError('Gagal memuat data: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Load data from specific sheet
        async function loadSheetData(sheetName) {
            const sheetNames = {
                'inbound': 'INBOUND',
                'outbound': 'OUTBOUND',
                'stock': 'STOCK'
            };
            
            // Optimized column ranges - synchronized up to Total Weight only
            const columnRanges = {
                'inbound': 'A:L',    // A to L (12 columns: Armada to Total Weight)
                'outbound': 'A:J',   // A to J (10 columns: Tanggal to Total Nett Weight)
                'stock': 'A:J'       // A to J (10 columns: Produk to Total Nett Weight)
            };
            
            const range = `${sheetNames[sheetName]}!${columnRanges[sheetName]}`;
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${range}?key=${API_KEY}&majorDimension=ROWS&valueRenderOption=FORMATTED_VALUE`;
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const rawData = data.values || [];
                
                // Process data in chunks for better performance
                cachedData[sheetName] = rawData;
                filteredData[sheetName] = rawData;
                
                // Use requestAnimationFrame for non-blocking UI updates
                requestAnimationFrame(() => {
                    populateFilterOptions(sheetName, rawData);
                    populateTable(sheetName, rawData);
                    updateDataCount(sheetName);
                });
                
            } catch (error) {
                console.error(`Error loading ${sheetName} data:`, error);
                throw error;
            }
        }

        // Smart search functionality
        function performSearch(sheetName) {
            const searchInput = document.getElementById(`search-${sheetName}`);
            const clearButton = document.getElementById(`clear-search-${sheetName}`);
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            searchTerms[sheetName] = searchTerm;
            
            // Show/hide clear button
            if (searchTerm) {
                clearButton.classList.remove('hidden');
            } else {
                clearButton.classList.add('hidden');
            }
            
            applySearchAndFilters(sheetName);
        }

        // Clear search
        function clearSearch(sheetName) {
            const searchInput = document.getElementById(`search-${sheetName}`);
            const clearButton = document.getElementById(`clear-search-${sheetName}`);
            
            searchInput.value = '';
            searchTerms[sheetName] = '';
            clearButton.classList.add('hidden');
            
            applySearchAndFilters(sheetName);
        }

        // Apply filters
        function applyFilters(sheetName) {
            const brandFilter = document.getElementById(`filter-brand-${sheetName}`).value;
            const sizeFilter = document.getElementById(`filter-size-${sheetName}`).value;
            
            if (sheetName === 'stock') {
                activeFilters[sheetName] = {
                    brand: brandFilter,
                    size: sizeFilter
                };
            } else {
                const dateFilter = document.getElementById(`filter-date-${sheetName}`).value;
                activeFilters[sheetName] = {
                    brand: brandFilter,
                    size: sizeFilter,
                    date: dateFilter
                };
            }
            
            applySearchAndFilters(sheetName);
        }

        // Reset all filters
        function resetFilters(sheetName) {
            // Reset search
            document.getElementById(`search-${sheetName}`).value = '';
            document.getElementById(`clear-search-${sheetName}`).classList.add('hidden');
            searchTerms[sheetName] = '';
            
            // Reset filters
            document.getElementById(`filter-brand-${sheetName}`).value = '';
            document.getElementById(`filter-size-${sheetName}`).value = '';
            
            if (sheetName === 'stock') {
                activeFilters[sheetName] = { brand: '', size: '' };
            } else {
                document.getElementById(`filter-date-${sheetName}`).value = '';
                activeFilters[sheetName] = { brand: '', size: '', date: '' };
            }
            
            applySearchAndFilters(sheetName);
        }

        // Apply both search and filters
        function applySearchAndFilters(sheetName) {
            if (!cachedData[sheetName] || cachedData[sheetName].length <= 1) {
                filteredData[sheetName] = cachedData[sheetName];
                populateTable(sheetName, filteredData[sheetName]);
                updateDataCount(sheetName);
                return;
            }
            
            const headers = cachedData[sheetName][0];
            let filtered = cachedData[sheetName].slice(1); // Skip header
            
            // Apply search
            if (searchTerms[sheetName]) {
                filtered = filtered.filter(row => {
                    return row.some(cell => 
                        cell && cell.toString().toLowerCase().includes(searchTerms[sheetName])
                    );
                });
            }
            
            // Apply filters
            const filters = activeFilters[sheetName];
            
            if (filters.brand) {
                const brandIndex = headers.findIndex(h => h.toLowerCase().includes('brand'));
                if (brandIndex !== -1) {
                    filtered = filtered.filter(row => 
                        row[brandIndex] && row[brandIndex].toLowerCase() === filters.brand.toLowerCase()
                    );
                }
            }
            
            if (filters.size) {
                const sizeIndex = headers.findIndex(h => h.toLowerCase().includes('size'));
                if (sizeIndex !== -1) {
                    filtered = filtered.filter(row => 
                        row[sizeIndex] && row[sizeIndex].toLowerCase() === filters.size.toLowerCase()
                    );
                }
            }
            
            if (filters.date && sheetName !== 'stock') {
                const dateIndex = headers.findIndex(h => h.toLowerCase().includes('tanggal'));
                if (dateIndex !== -1) {
                    filtered = filtered.filter(row => {
                        if (!row[dateIndex]) return false;
                        
                        const cellDate = row[dateIndex].toString().trim();
                        const filterDate = filters.date;
                        
                        // Handle different date formats commonly used in Indonesian sheets
                        try {
                            // Convert filter date to various formats for comparison
                            const filterDateObj = new Date(filterDate);
                            const filterDay = filterDateObj.getDate().toString().padStart(2, '0');
                            const filterMonth = (filterDateObj.getMonth() + 1).toString().padStart(2, '0');
                            const filterYear = filterDateObj.getFullYear().toString();
                            
                            // Common Indonesian date formats to check
                            const formatsToCheck = [
                                `${filterDay}/${filterMonth}/${filterYear}`,     // DD/MM/YYYY
                                `${filterDay}-${filterMonth}-${filterYear}`,     // DD-MM-YYYY
                                `${filterYear}-${filterMonth}-${filterDay}`,     // YYYY-MM-DD
                                `${filterDay}/${filterMonth}/${filterYear.slice(-2)}`, // DD/MM/YY
                                `${filterDay}-${filterMonth}-${filterYear.slice(-2)}`, // DD-MM-YY
                                filterDate // Original format
                            ];
                            
                            // Check if cell date matches any of the expected formats
                            return formatsToCheck.some(format => cellDate.includes(format)) ||
                                   cellDate === filterDate ||
                                   cellDate.startsWith(filterDate);
                            
                        } catch (e) {
                            // Fallback: simple string matching
                            return cellDate.includes(filterDate) || 
                                   cellDate.includes(filterDate.replace(/-/g, '/')) ||
                                   cellDate.includes(filterDate.replace(/\//g, '-'));
                        }
                    });
                }
            }
            
            // Add header back
            filteredData[sheetName] = [headers, ...filtered];
            populateTable(sheetName, filteredData[sheetName]);
            updateDataCount(sheetName);
        }

        // Populate filter options
        function populateFilterOptions(sheetName, data) {
            if (!data || data.length <= 1) return;
            
            const headers = data[0];
            const rows = data.slice(1);
            
            // Get unique values for each filter
            const brandIndex = headers.findIndex(h => h.toLowerCase().includes('brand'));
            const sizeIndex = headers.findIndex(h => h.toLowerCase().includes('size'));
            const packingIndex = headers.findIndex(h => h.toLowerCase().includes('packing'));
            
            // Populate brand filter
            if (brandIndex !== -1) {
                const brands = [...new Set(rows.map(row => row[brandIndex]).filter(Boolean))].sort();
                const brandSelect = document.getElementById(`filter-brand-${sheetName}`);
                brandSelect.innerHTML = '<option value="">Semua Brand</option>' + 
                    brands.map(brand => `<option value="${brand}">${brand}</option>`).join('');
            }
            
            // Populate size filter
            if (sizeIndex !== -1) {
                const sizes = [...new Set(rows.map(row => row[sizeIndex]).filter(Boolean))].sort();
                const sizeSelect = document.getElementById(`filter-size-${sheetName}`);
                sizeSelect.innerHTML = '<option value="">Semua Size</option>' + 
                    sizes.map(size => `<option value="${size}">${size}</option>`).join('');
            }
            
            // Date filter doesn't need population as it's an input field
        }

        // Update data count
        function updateDataCount(sheetName) {
            const countElement = document.getElementById(`${sheetName}-count`);
            if (filteredData[sheetName] && filteredData[sheetName].length > 1) {
                const count = filteredData[sheetName].length - 1; // Exclude header
                const totalCount = cachedData[sheetName] ? cachedData[sheetName].length - 1 : 0;
                
                if (count === totalCount) {
                    countElement.textContent = `${count} data`;
                } else {
                    countElement.textContent = `${count} dari ${totalCount} data`;
                }
            } else {
                countElement.textContent = '0 data';
            }
        }

        // Toggle between card and table view
        function toggleView(sheetName) {
            const currentMode = viewModes[sheetName];
            const newMode = currentMode === 'card' ? 'table' : 'card';
            viewModes[sheetName] = newMode;
            
            const cardContainer = document.getElementById(`${sheetName}-cards`);
            const tableContainer = document.getElementById(`${sheetName}-table-view`);
            const toggleButton = document.getElementById(`view-toggle-${sheetName}`);
            
            if (newMode === 'card') {
                cardContainer.classList.remove('hidden');
                tableContainer.classList.add('hidden');
                toggleButton.innerHTML = '📊 Tabel';
            } else {
                cardContainer.classList.add('hidden');
                tableContainer.classList.remove('hidden');
                toggleButton.innerHTML = '🃏 Card';
            }
        }

        // Show detail modal
        function showDetailModal(sheetName, rowIndex) {
            const data = filteredData[sheetName] || cachedData[sheetName];
            if (!data || data.length <= rowIndex + 1) return;
            
            const headers = data[0];
            const rowData = data[rowIndex + 1];
            const essentialFields = getEssentialFields(sheetName, headers);
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${essentialFields.map(field => {
                        const value = rowData[field.index] || '-';
                        const isNumeric = !isNaN(value) && value !== '-' && value !== '';
                        return `
                            <div class="bg-gray-50 rounded-lg p-4">
                                <label class="text-sm font-semibold text-gray-600 uppercase tracking-wider">${field.header}</label>
                                <div class="mt-1 text-lg font-medium ${isNumeric ? 'text-blue-600' : 'text-gray-900'}">${value}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                    <p class="text-xs text-blue-600 text-center"> 
                    </p>
                </div>
            `;
            
            document.getElementById('detailModal').classList.remove('hidden');
        }

        // Close detail modal
        function closeDetailModal() {
            document.getElementById('detailModal').classList.add('hidden');
        }

        // Populate table with data (optimized for performance)
        function populateTable(sheetName, data) {
            const tableBody = document.getElementById(`${sheetName}-table`);
            
            if (!data || data.length <= 1) {
                tableBody.innerHTML = '<tr><td colspan="100%" class="px-4 py-8 text-center text-gray-500 text-sm sm:text-base">Tidak ada data tersedia</td></tr>';
                populateCards(sheetName, data);
                return;
            }
            
            // Skip header row (index 0) and limit initial display for performance
            const rows = data.slice(1);
            const maxInitialRows = 100; // Show first 100 rows for better performance
            const displayRows = rows.slice(0, maxInitialRows);
            
            // Use DocumentFragment for better performance
            const fragment = document.createDocumentFragment();
            const tempDiv = document.createElement('div');
            
            const tableHTML = displayRows.map((row, index) => {
                const cells = row.map(cell => {
                    const cellValue = cell || '-';
                    const isNumeric = !isNaN(cellValue) && cellValue !== '-' && cellValue !== '';
                    const cellClass = isNumeric ? 'font-semibold text-blue-600' : 'text-gray-900';
                    return `<td class="px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm ${cellClass} whitespace-nowrap">${cellValue}</td>`;
                }).join('');
                const actionCell = `<td class="px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm whitespace-nowrap">
                    <button onclick="showDetailModal('${sheetName}', ${index})" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors">
                        👁️ Detail
                    </button>
                </td>`;
                const rowClass = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                return `<tr class="${rowClass} hover:bg-blue-50 transition-colors border-l-4 border-transparent hover:border-blue-400">${cells}${actionCell}</tr>`;
            }).join('');
            
            tableBody.innerHTML = tableHTML;
            
            // Show load more button if there are more rows
            if (rows.length > maxInitialRows) {
                const loadMoreRow = document.createElement('tr');
                loadMoreRow.innerHTML = `<td colspan="100%" class="px-4 py-4 text-center">
                    <button onclick="loadMoreRows('${sheetName}')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                        📄 Muat ${Math.min(50, rows.length - maxInitialRows)} Data Lagi (${rows.length - maxInitialRows} tersisa)
                    </button>
                </td>`;
                tableBody.appendChild(loadMoreRow);
            }
            
            // Also populate cards
            populateCards(sheetName, data);
        }
        
        // Load more rows function
        function loadMoreRows(sheetName) {
            const data = filteredData[sheetName] || cachedData[sheetName];
            if (!data || data.length <= 1) return;
            
            const tableBody = document.getElementById(`${sheetName}-table`);
            const currentRows = tableBody.querySelectorAll('tr').length - 1; // Exclude load more button
            const allRows = data.slice(1);
            const nextBatch = allRows.slice(currentRows, currentRows + 50);
            
            // Remove load more button
            const loadMoreButton = tableBody.querySelector('tr:last-child');
            if (loadMoreButton && loadMoreButton.textContent.includes('Muat')) {
                loadMoreButton.remove();
            }
            
            // Add new rows
            nextBatch.forEach((row, index) => {
                const actualIndex = currentRows + index;
                const cells = row.map(cell => {
                    const cellValue = cell || '-';
                    const isNumeric = !isNaN(cellValue) && cellValue !== '-' && cellValue !== '';
                    const cellClass = isNumeric ? 'font-semibold text-blue-600' : 'text-gray-900';
                    return `<td class="px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm ${cellClass} whitespace-nowrap">${cellValue}</td>`;
                }).join('');
                const actionCell = `<td class="px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm whitespace-nowrap">
                    <button onclick="showDetailModal('${sheetName}', ${actualIndex})" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors">
                        👁️ Detail
                    </button>
                </td>`;
                const rowClass = actualIndex % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                const newRow = document.createElement('tr');
                newRow.className = `${rowClass} hover:bg-blue-50 transition-colors border-l-4 border-transparent hover:border-blue-400`;
                newRow.innerHTML = `${cells}${actionCell}`;
                tableBody.appendChild(newRow);
            });
            
            // Add load more button if there are still more rows
            const remainingRows = allRows.length - (currentRows + nextBatch.length);
            if (remainingRows > 0) {
                const loadMoreRow = document.createElement('tr');
                loadMoreRow.innerHTML = `<td colspan="100%" class="px-4 py-4 text-center">
                    <button onclick="loadMoreRows('${sheetName}')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                        📄 Muat ${Math.min(50, remainingRows)} Data Lagi (${remainingRows} tersisa)
                    </button>
                </td>`;
                tableBody.appendChild(loadMoreRow);
            }
        }

        // Populate cards with data (optimized with lazy loading)
        function populateCards(sheetName, data) {
            const cardContainer = document.getElementById(`${sheetName}-cards`);
            
            if (!data || data.length <= 1) {
                cardContainer.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Tidak ada data tersedia</div>';
                return;
            }
            
            const headers = data[0];
            const rows = data.slice(1);
            const maxInitialCards = 50; // Show first 50 cards for better performance
            const displayRows = rows.slice(0, maxInitialCards);
            
            const getCardColor = (sheetName) => {
                switch(sheetName) {
                    case 'inbound': return 'from-green-500 to-green-600';
                    case 'outbound': return 'from-red-500 to-red-600';
                    case 'stock': return 'from-blue-500 to-blue-600';
                    default: return 'from-gray-500 to-gray-600';
                }
            };
            
            const cardsHTML = displayRows.map((row, index) => {
                const mainInfo = getMainCardInfo(sheetName, headers, row);
                return `
                    <div class="glass-effect rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 cursor-pointer border border-gray-200"
                         onclick="showDetailModal('${sheetName}', ${index})">
                        <div class="bg-gradient-to-r ${getCardColor(sheetName)} px-4 py-3 rounded-t-xl">
                            <h3 class="font-bold text-white text-sm">${mainInfo.title}</h3>
                            <p class="text-white text-xs opacity-90">${mainInfo.subtitle}</p>
                        </div>
                        <div class="p-4">
                            <div class="grid grid-cols-2 gap-3 text-xs">
                                ${mainInfo.details.map(detail => `
                                    <div>
                                        <span class="text-gray-500 font-medium">${detail.label}:</span>
                                        <div class="font-semibold text-gray-900 ${detail.isNumeric ? 'text-blue-600' : ''}">${detail.value}</div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-4 pt-3 border-t border-gray-200">
                                <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded-lg text-xs font-medium transition-colors">
                                    👁️ Lihat Detail
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            cardContainer.innerHTML = cardsHTML;
            
            // Add load more button for cards if there are more rows
            if (rows.length > maxInitialCards) {
                const loadMoreCard = document.createElement('div');
                loadMoreCard.className = 'col-span-full flex justify-center py-4';
                loadMoreCard.innerHTML = `
                    <button onclick="loadMoreCards('${sheetName}')" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg text-sm transition-colors shadow-lg">
                        📄 Muat ${Math.min(25, rows.length - maxInitialCards)} Card Lagi (${rows.length - maxInitialCards} tersisa)
                    </button>
                `;
                cardContainer.appendChild(loadMoreCard);
            }
        }
        
        // Load more cards function
        function loadMoreCards(sheetName) {
            const data = filteredData[sheetName] || cachedData[sheetName];
            if (!data || data.length <= 1) return;
            
            const cardContainer = document.getElementById(`${sheetName}-cards`);
            const currentCards = cardContainer.querySelectorAll('.glass-effect').length;
            const headers = data[0];
            const allRows = data.slice(1);
            const nextBatch = allRows.slice(currentCards, currentCards + 25);
            
            // Remove load more button
            const loadMoreButton = cardContainer.querySelector('.col-span-full');
            if (loadMoreButton) {
                loadMoreButton.remove();
            }
            
            const getCardColor = (sheetName) => {
                switch(sheetName) {
                    case 'inbound': return 'from-green-500 to-green-600';
                    case 'outbound': return 'from-red-500 to-red-600';
                    case 'stock': return 'from-blue-500 to-blue-600';
                    default: return 'from-gray-500 to-gray-600';
                }
            };
            
            // Add new cards
            nextBatch.forEach((row, index) => {
                const actualIndex = currentCards + index;
                const mainInfo = getMainCardInfo(sheetName, headers, row);
                const newCard = document.createElement('div');
                newCard.className = 'glass-effect rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 cursor-pointer border border-gray-200';
                newCard.onclick = () => showDetailModal(sheetName, actualIndex);
                newCard.innerHTML = `
                    <div class="bg-gradient-to-r ${getCardColor(sheetName)} px-4 py-3 rounded-t-xl">
                        <h3 class="font-bold text-white text-sm">${mainInfo.title}</h3>
                        <p class="text-white text-xs opacity-90">${mainInfo.subtitle}</p>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-2 gap-3 text-xs">
                            ${mainInfo.details.map(detail => `
                                <div>
                                    <span class="text-gray-500 font-medium">${detail.label}:</span>
                                    <div class="font-semibold text-gray-900 ${detail.isNumeric ? 'text-blue-600' : ''}">${detail.value}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-4 pt-3 border-t border-gray-200">
                            <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded-lg text-xs font-medium transition-colors">
                                👁️ Lihat Detail
                            </button>
                        </div>
                    </div>
                `;
                cardContainer.appendChild(newCard);
            });
            
            // Add load more button if there are still more rows
            const remainingRows = allRows.length - (currentCards + nextBatch.length);
            if (remainingRows > 0) {
                const loadMoreCard = document.createElement('div');
                loadMoreCard.className = 'col-span-full flex justify-center py-4';
                loadMoreCard.innerHTML = `
                    <button onclick="loadMoreCards('${sheetName}')" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg text-sm transition-colors shadow-lg">
                        📄 Muat ${Math.min(25, remainingRows)} Card Lagi (${remainingRows} tersisa)
                    </button>
                `;
                cardContainer.appendChild(loadMoreCard);
            }
        }

        // Get main information for card display
        function getMainCardInfo(sheetName, headers, row) {
            const getValue = (headerName) => {
                const index = headers.findIndex(h => h.toLowerCase().includes(headerName.toLowerCase()));
                return index !== -1 ? (row[index] || '-') : '-';
            };
            
            const isNumeric = (value) => !isNaN(value) && value !== '-' && value !== '';
            
            switch(sheetName) {
                case 'inbound':
                    return {
                        title: getValue('produk') || 'Produk Tidak Diketahui',
                        subtitle: `${getValue('brand')} - ${getValue('size')}`,
                        details: [
                            { label: 'Armada', value: getValue('armada'), isNumeric: false },
                            { label: 'Tanggal', value: getValue('tanggal'), isNumeric: false },
                            { label: 'QTY', value: getValue('qty'), isNumeric: isNumeric(getValue('qty')) },
                            { label: 'PO', value: getValue('po'), isNumeric: false },
                            { label: 'Total Weight', value: getValue('total weight'), isNumeric: isNumeric(getValue('total weight')) },
                            { label: 'Delivery', value: getValue('delivery'), isNumeric: false }
                        ]
                    };
                case 'outbound':
                    return {
                        title: getValue('produk') || 'Produk Tidak Diketahui',
                        subtitle: `${getValue('brand')} - ${getValue('size')}`,
                        details: [
                            { label: 'Invoice', value: getValue('invoice'), isNumeric: false },
                            { label: 'Tanggal', value: getValue('tanggal'), isNumeric: false },
                            { label: 'QTY', value: getValue('qty'), isNumeric: isNumeric(getValue('qty')) },
                            { label: 'PO', value: getValue('po'), isNumeric: false },
                            { label: 'Total Nett Weight', value: getValue('total nett weight'), isNumeric: isNumeric(getValue('total nett weight')) },
                            { label: 'Jam Proses', value: getValue('jam proses'), isNumeric: false }
                        ]
                    };
                case 'stock':
                    return {
                        title: getValue('produk') || 'Produk Tidak Diketahui',
                        subtitle: `${getValue('brand')} - ${getValue('size')}`,
                        details: [
                            { label: 'PO', value: getValue('po'), isNumeric: false },
                            { label: 'Packing', value: getValue('packing'), isNumeric: false },
                            { label: 'In GIM', value: getValue('in gim'), isNumeric: isNumeric(getValue('in gim')) },
                            { label: 'Out GIM', value: getValue('out gim'), isNumeric: isNumeric(getValue('out gim')) },
                            { label: 'Stok GIM', value: getValue('stok gim'), isNumeric: isNumeric(getValue('stok gim')) },
                            { label: 'Total Nett Weight', value: getValue('total nett weight'), isNumeric: isNumeric(getValue('total nett weight')) }
                        ]
                    };
                default:
                    return {
                        title: 'Data',
                        subtitle: 'Informasi',
                        details: headers.slice(0, 6).map(header => ({
                            label: header,
                            value: getValue(header),
                            isNumeric: isNumeric(getValue(header))
                        }))
                    };
            }
        }

        // Get essential fields for detail modal (synchronized up to Total Weight)
        function getEssentialFields(sheetName, headers) {
            const essentialFields = {
                'inbound': ['Armada', 'Tanggal', 'Produk', 'Size', 'Packing', 'Brand', 'PO', 'QTY', 'Delivery', 'Jam', 'Nett Weight', 'Total Weight'],
                'outbound': ['Tanggal', 'Invoice', 'Produk', 'Size', 'Packing', 'Brand', 'PO', 'QTY', 'Nett Weight', 'Total Nett Weight'],
                'stock': ['Produk', 'Size', 'Packing', 'Brand', 'PO', 'In GIM', 'Out GIM', 'Stok GIM', 'Nett Weight', 'Total Nett Weight']
            };
            
            const fieldsToShow = essentialFields[sheetName] || headers;
            return headers.map((header, index) => ({
                header,
                index,
                show: fieldsToShow.some(field => header.toLowerCase().includes(field.toLowerCase()))
            })).filter(item => item.show);
        }

        // Refresh all data
        async function refreshAllData() {
            // Clear cached data
            cachedData = {
                inbound: null,
                outbound: null,
                stock: null
            };
            filteredData = {
                inbound: null,
                outbound: null,
                stock: null
            };
            
            // Reset search and filters
            searchTerms = {
                inbound: '',
                outbound: '',
                stock: ''
            };
            activeFilters = {
                inbound: { brand: '', size: '', date: '' },
                outbound: { brand: '', size: '', date: '' },
                stock: { brand: '', size: '' }
            };
            
            // Clear UI elements
            ['inbound', 'outbound', 'stock'].forEach(sheetName => {
                const searchInput = document.getElementById(`search-${sheetName}`);
                const clearButton = document.getElementById(`clear-search-${sheetName}`);
                if (searchInput) searchInput.value = '';
                if (clearButton) clearButton.classList.add('hidden');
                
                const brandFilter = document.getElementById(`filter-brand-${sheetName}`);
                const sizeFilter = document.getElementById(`filter-size-${sheetName}`);
                if (brandFilter) brandFilter.value = '';
                if (sizeFilter) sizeFilter.value = '';
                
                if (sheetName !== 'stock') {
                    const dateFilter = document.getElementById(`filter-date-${sheetName}`);
                    if (dateFilter) dateFilter.value = '';
                }
            });
            
            await loadAllData();
        }

        // Show/hide loading indicator
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        // Show error message
        function showError(message) {
            const error = document.getElementById('error');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            error.classList.remove('hidden');
        }

        // Hide error message
        function hideError() {
            document.getElementById('error').classList.add('hidden');
        }

        // Get sheet last modified time from Google Drive API
        async function getSheetLastModified() {
            try {
                // Use Google Drive API v3 to get file metadata
                const driveUrl = `https://www.googleapis.com/drive/v3/files/${SHEET_ID}?key=${API_KEY}&fields=modifiedTime,name`;
                const response = await fetch(driveUrl);
                
                if (!response.ok) {
                    throw new Error(`Drive API error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.modifiedTime) {
                    const modifiedDate = new Date(data.modifiedTime);
                    
                    // Convert to Jakarta timezone (WIB)
                    const jakartaTime = new Date(modifiedDate.toLocaleString("en-US", {timeZone: "Asia/Jakarta"}));
                    
                    const timeString = jakartaTime.toLocaleString('id-ID', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        timeZone: 'Asia/Jakarta'
                    });
                    
                    document.getElementById('lastUpdate').textContent = `Data update: ${timeString} WIB`;
                } else {
                    // Fallback to current time if modifiedTime is not available
                    updateLastUpdateTime();
                }
            } catch (error) {
                console.error('Error getting Drive file modified time:', error);
                // Try alternative method with Sheets API
                try {
                    const sheetsUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}?key=${API_KEY}&fields=properties`;
                    const sheetsResponse = await fetch(sheetsUrl);
                    
                    if (sheetsResponse.ok) {
                        const sheetsData = await sheetsResponse.json();
                        console.log('Sheets API response:', sheetsData);
                    }
                } catch (sheetsError) {
                    console.error('Sheets API also failed:', sheetsError);
                }
                
                // Fallback to current time
                updateLastUpdateTime();
            }
        }

        // Fallback function for current time
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('id-ID', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = `Sheet terakhir di modif di Drive: ${timeString}`;
        }

        // Export data functionality
        function exportData(sheetName, format) {
            const data = filteredData[sheetName] || cachedData[sheetName];
            if (!data || data.length <= 1) {
                alert('Tidak ada data untuk diekspor');
                return;
            }

            const headers = data[0];
            const rows = data.slice(1);
            const timestamp = new Date().toLocaleString('id-ID').replace(/[/:]/g, '-');
            const filename = `${sheetName.toUpperCase()}_${timestamp}`;

            if (format === 'pdf') {
                exportToPDF(sheetName, headers, rows, filename);
            } else if (format === 'xlsx') {
                exportToExcel(sheetName, headers, rows, filename);
            }
        }

        // Export to PDF
        function exportToPDF(sheetName, headers, rows, filename) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4'); // Landscape orientation
            
            // Add title
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text(`Data ${sheetName.toUpperCase()}`, 20, 20);
            
            // Add export info
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            const exportTime = new Date().toLocaleString('id-ID');
            doc.text(`Diekspor pada: ${exportTime}`, 20, 30);
            doc.text(`Total data: ${rows.length} baris`, 20, 35);
            
            // Prepare table data
            const tableData = rows.map(row => 
                row.map(cell => cell ? cell.toString() : '-')
            );
            
            // Auto table configuration
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: 45,
                styles: {
                    fontSize: 8,
                    cellPadding: 2,
                    overflow: 'linebreak',
                    halign: 'left'
                },
                headStyles: {
                    fillColor: [59, 130, 246], // Blue color
                    textColor: 255,
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [248, 250, 252] // Light gray
                },
                columnStyles: {
                    // Auto-adjust column widths based on content
                },
                margin: { top: 45, right: 10, bottom: 20, left: 10 },
                didDrawPage: function (data) {
                    // Add page numbers
                    const pageCount = doc.internal.getNumberOfPages();
                    const pageSize = doc.internal.pageSize;
                    const pageHeight = pageSize.height ? pageSize.height : pageSize.getHeight();
                    doc.setFontSize(8);
                    doc.text(`Halaman ${data.pageNumber} dari ${pageCount}`, 
                        data.settings.margin.left, pageHeight - 10);
                }
            });
            
            // Save the PDF
            doc.save(`${filename}.pdf`);
        }

        // Export to Excel
        function exportToExcel(sheetName, headers, rows, filename) {
            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            
            // Prepare data with headers
            const wsData = [headers, ...rows];
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Auto-size columns
            const colWidths = headers.map((header, colIndex) => {
                const maxLength = Math.max(
                    header.length,
                    ...rows.map(row => (row[colIndex] || '').toString().length)
                );
                return { wch: Math.min(maxLength + 2, 30) }; // Max width 30 characters
            });
            ws['!cols'] = colWidths;
            
            // Style the header row
            const headerRange = XLSX.utils.decode_range(ws['!ref']);
            for (let col = headerRange.s.c; col <= headerRange.e.c; col++) {
                const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });
                if (!ws[cellAddress]) continue;
                
                ws[cellAddress].s = {
                    font: { bold: true, color: { rgb: "FFFFFF" } },
                    fill: { fgColor: { rgb: "3B82F6" } }, // Blue background
                    alignment: { horizontal: "center", vertical: "center" }
                };
            }
            
            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, sheetName.toUpperCase());
            
            // Add metadata sheet
            const metaData = [
                ['Informasi Export'],
                ['Tanggal Export', new Date().toLocaleString('id-ID')],
                ['Sheet', sheetName.toUpperCase()],
                ['Total Data', rows.length],
                ['Filter Aktif', getActiveFiltersText(sheetName)],
                ['Pencarian', searchTerms[sheetName] || 'Tidak ada']
            ];
            
            const metaWs = XLSX.utils.aoa_to_sheet(metaData);
            metaWs['!cols'] = [{ wch: 20 }, { wch: 30 }];
            XLSX.utils.book_append_sheet(wb, metaWs, 'Info Export');
            
            // Save the file
            XLSX.writeFile(wb, `${filename}.xlsx`);
        }

        // Get active filters text for export metadata
        function getActiveFiltersText(sheetName) {
            const filters = activeFilters[sheetName];
            const activeFiltersArray = [];
            
            if (filters.brand) activeFiltersArray.push(`Brand: ${filters.brand}`);
            if (filters.size) activeFiltersArray.push(`Size: ${filters.size}`);
            if (filters.date && sheetName !== 'stock') activeFiltersArray.push(`Tanggal: ${filters.date}`);
            
            return activeFiltersArray.length > 0 ? activeFiltersArray.join(', ') : 'Tidak ada filter';
        }

        // Auto-refresh every 5 minutes
        setInterval(refreshAllData, 5 * 60 * 1000);

        // Close modal when clicking outside
        document.getElementById('detailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDetailModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'984354fe8619ef6d',t:'MTc1ODcyNzkyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
